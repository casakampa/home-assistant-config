tts_statusupdate:
  alias: "TTS: Statusupdate"
  icon: "mdi:speaker-message"
  variables:
    dagdeel: >-
      {% set hour = now().hour %}
      {% if hour < 12 %}
        Goedemorgen
      {% elif hour < 18 %}
        Goedemiddag
      {% else %}
        Goedenavond
      {% endif %}
    dag: >
      Het is {{ {'Monday': 'maandag', 'Tuesday': 'dinsdag', 'Wednesday': 'woensdag', 'Thursday': 'donderdag', 'Friday': 'vrijdag', 'Saturday': 'zaterdag', 'Sunday': 'zondag'}[now().strftime('%A')] }}
    tijd: >
      {% from 'tts_functions.jinja' import dutch_time_announcement %}
      {% set nu = now().strftime('%H:%M') %}
      Het is {{ dutch_time_announcement(nu) }}
    buitentemperatuur: >
      De buitentemperatuur is momenteel
      {{ iif(has_value('sensor.buitentemperatuur'),
      states('sensor.buitentemperatuur').replace('.', ' komma ') ~ ' graden',
      'niet beschikbaar')
      }}
    afvalsoort: "{{ iif( is_state_attr('sensor.afvalwijzer_volgende_leging', 'afvalsoort', 'GFT'), 'groente, fruit en tuinafval', state_attr('sensor.afvalwijzer_volgende_leging', 'afvalsoort')) }}"
    container: >-
      {% if not is_state('sensor.afvalwijzer_tomorrow', 'Geen') %}
        Vanavond moet de {{ afvalsoort }}container aan de weg worden gezet.
      {% elif is_state('input_boolean.kliko_aan_de_weg', 'on') %}
        Vandaag wordt de {{ afvalsoort }}container geleegd.
      {% endif %}
    werk: >-
      {% if now().isoweekday() in range(6) %}
        {{ iif(is_state('binary_sensor.workday_sensor', 'on'),
        'Vandaag werk je ' ~ iif(is_state('input_boolean.thuiswerk_status', 'off'), 'in ' + werklocatie, 'thuis'),
        'Je hoeft vandaag niet te werken')
        }}
      {% endif %}
  sequence:
    - service: media_player.volume_set
      target:
        entity_id:
          - media_player.sonos_slaapkamer
      data:
        volume_level: 0.5
    - service: tts.speak
      target:
        entity_id: tts.piper
      data:
        cache: false
        media_player_entity_id:
          - media_player.sonos_slaapkamer
        message: >-
          {{ dagdeel }}!
          {{ dag }}, {{ tijd }}.
          {{ buitentemperatuur }}.
          {{ container }}.
          {{ werk }}.
