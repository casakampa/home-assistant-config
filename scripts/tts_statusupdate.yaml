tts_statusupdate:
  alias: "TTS: Statusupdate"
  icon: "mdi:speaker-message"
  variables:
    media_player: media_player.sonos_slaapkamer
    dagdeel: >-
      {% set hour = now().hour %}
      {% if hour < 12 %}
        Goedemorgen
      {% elif hour < 18 %}
        Goedemiddag
      {% else %}
        Goedenavond
      {% endif %}
    dag: >-
      {% from 'date_functions.jinja' import vandaag %}
      {{ vandaag() }}
    tijd: >-
      {% from 'tts_functions.jinja' import uitgesproken_tijd_v3 %}
      {% set nu = now().strftime('%H:%M') %}
      {{ uitgesproken_tijd_v3(nu) }}
    buitentemperatuur: >-
      {{ iif(has_value('sensor.buitentemperatuur'),
      'Het is buiten ' + states('sensor.buitentemperatuur').replace('.', ' komma ') + ' graden',
      'De buitentemperatuur is niet beschikbaar')
      }}
    afvalsoort: >-
      {{ iif(is_state_attr('sensor.afvalwijzer_volgende_leging', 'afvalsoort', 'GFT'), 'groente, fruit en tuinafval', state_attr('sensor.afvalwijzer_volgende_leging', 'afvalsoort')) }}
    kliko: >-
      {% if int(states('sensor.afvalwijzer_next_in_days')) <= 2 %}
      De {{ afvalsoort }}-kliko wordt {{ states('sensor.afvalwijzer_volgende_leging') }} geleegd
      {% endif %}
    weersverwachting: >-
      {{ 'De weersverwachting: ' +
      iif(has_value('sensor.thuis_weather_forecast'),
      states('sensor.thuis_weather_forecast'),
      'niet beschikbaar')
      }}
  sequence:
    - action: media_player.volume_set
      target:
        entity_id: "{{ media_player }}"
      data:
        volume_level: "{{ states('input_number.sonos_media_volume') | int / 100 }}"
    - action: tts.speak
      target:
        entity_id: tts.piper
      data:
        cache: false
        media_player_entity_id: "{{ media_player }}"
        message: >-
          {{ dagdeel }}!
          Het is {{ dag }}, en {{ tijd }}.
          {{ buitentemperatuur }}.
          {{ weersverwachting }}.
          {{ kliko }}
